<html>
<head>
<link href="css/south-street/jquery-ui-1.8.20.custom.css"
	rel="stylesheet" type="text/css" />
<link href="css/estore.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="js/jquery-1.7.2.min.js"></script>
<script type="text/javascript" src="js/jquery-ui-1.8.20.custom.min.js"></script>
<script type="text/javascript" src="mule-resource/js/mule.js"></script>
<script type="text/javascript">
	$(function() {
		$.ajax({
			url : "http://localhost:8091/populate"
		});
		mule.rpc("/orders/manufacturers", "", manufacturersResponse);
		tabs = $("#tabs").tabs({
			selected : 0
		});
		$('.button').button();

		$('#addItemButton').click(function() {
			$('#orderItemTable tbody').append('<tr><td class="manufacturer">' + '</td><td class="name">' + $("#productName").val() + '</td><td class="productId">' + $("#productId").val() + '</td><td class="quantity">' + $("#quantity").val() + '</td><td><a class="deleteButton" style="background-color: red; color:white; padding: 2px 5px;">Delete</a></tr>');
			$('.deleteButton')
				.click(function() {
					$(this).parent('td').parent('tr').remove();
				});
			$('#newItem input').val('');
		});
		$('#submitButton').click(function() {
			var order = {
				orderId: $('#orderId').val(),
				customer: {
					firstName: $('#firstName').val(),
					lastName: $('#lastName').val(),
					address: $('#address').val()
				},
				orderItems: []
			}
			$('#orderItemTable tbody tr').each(function() {
				var manufacturer = $('td.manufacturer', this)[0].innerHTML;
				var name = $('td.name', this)[0].innerHTML;
				var productId = $('td.productId', this)[0].innerHTML;
				var quantity = $('td.quantity', this)[0].innerHTML;
				orderRequest.orderItems.push({
					"manufacturer" : manufacturer,
					"name" : name,
					"productId" : productId,
					"quantity" : quantity
				})
				
			})
			var request = JSON.stringify(order);
			mule.rpc("/orders/request", request, orderResponse);
		});
		$('#resetButton').click(function() {
			$('#main input').val('');
		});
		function manufacturersResponse(message, error) {
			if (error != null) {
				alert(message.data);
				products = JSON.parse(message.data);
				alert(products);
				for (i = 0; i < products.length; i++) {
					$('#manufacturerSelect').append(
							'<option value=' + '"' + products[i] + '">' + products[i]
									+ '</option>')
				}
			} else {
				alert(error.data);
			}	
		}
		function orderResponse(message) {
			tabs.tabs('select', 1);
			alert(message.data);
		}

	});
</script>
</head>
<body>

<h1>Mule Order Processing</h1>
<div id="tabs">
<ul>
	<li><a href="#form"><span>Form</span></a></li>
	<li><a href="#confirmation"><span>Confirmation</span></a></li>
</ul>
<div id="summary" style="float:right; width:50%; padding: 1em;">
<a id="submitButton" class="button" style="float:right;">Submit &gt;&gt;</a>
<a id="resetButton" class="button" style="float: right:">Reset</a>
<p>Order Summary</p>
<table style="width: 100%; text-align:left;" id='orderItemTable'>
	<thead>
	<tr>
		<th>Manufacturer</th>
		<th>Name</th>
		<th>Product Id</th>
		<th>Quantity</th>
		<th></th>
	</tr>
	</thead>
	<tbody/>
</table>
</div>
<div id="main" style="padding: 1em;">
<p>Customer Details</p>
<table width='40%' class='payment'>
	<tr>
		<td class="title">Order Id</td>
		<td class="field"><input size="10" maxlength="16" name="orderId" id="orderId"
			type="text" /></td>
	</tr>
	<tr>
		<td class="title">First Name:</td>
		<td class="field"><input size="30" name="firstName" id="firstName"
			type="text" />
		</td>
	</tr>
	<tr>
		<td class="title">Last Name:</td>
		<td class="field"><input size="30" maxlength="100"
			name="lastName" id="lastName" type="text" /></td>
	</tr>
	<tr>
		<td class="title">Address:</td>
		<td class="field"><input size="30" maxlength="100" name="address" id="address"
			type="text" /></td>
	</tr>
</table>
<div id="newItem" style="width:50%;">
<p>Add a new Order Item</p>
<table>
	<tr>
		<td class="title">Manufacturer:</td>
		<td class="field"><select id="manufacturerSelect" /></td>
	</tr>
	<tr>
		<td class="title">Name:</td>
		<td class="field"><input size="30" maxlength="100"
			name="productName" id="productName" type="text" /></td>
	</tr>
	<tr>
		<td class="title">Product Id:</td>
		<td class="field"><input size="10" maxlength="100"
			name="productId" id="productId" type="text" /></td>
	</tr>
	<tr>
		<td class="title">Quantity:</td>
		<td class="field"><input size="10" maxlength="100"
			name="quantity" id="quantity" type="text" /></td>
	</tr>

</table>
<a id="addItemButton" class="button">Add</a>
</div>
</div>
</div>

</body>
</html>